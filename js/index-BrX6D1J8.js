import{j as e,E as t,J as n,w as s,i as a,a as l,c as o,b as r,R as c}from"./.pnpm-DD1cSUAy.js";function i({error:t}){return e.jsxs("div",{role:"alert",children:[e.jsx("p",{children:"Something went wrong:"}),e.jsx("pre",{style:{color:"red"},children:t.message})]})}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const d=({children:n,fallback:s})=>e.jsx(t,{fallbackRender:s?()=>s:i,children:n}),u=()=>e.jsx(d,{children:e.jsx("div",{className:"flex justify-center content-center min-h-screen",style:{mask:"linear-gradient(black, transparent)"},children:e.jsx("span",{className:"loading loading-spinner loading-lg",style:{width:"3rem"}})})}),m=({title:t,children:n,isOpen:s,onClose:a,onOk:l})=>{const o=React.useRef(null);return React.useEffect((()=>{s&&(null==o?void 0:o.current)&&(null==o||o.current.showModal());const e=e=>"Escape"===e.key?a():null;return document.body.addEventListener("keydown",e),()=>{document.body.removeEventListener("keydown",e)}}),[a,s,o]),s?ReactDOM.createPortal(e.jsx(d,{children:e.jsxs("dialog",{id:"my_modal_2",className:"modal",ref:o,children:[e.jsxs("div",{className:"modal-box",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("h2",{children:t}),e.jsx("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-3 top-4",onClick:a,children:"✕"})]}),n,e.jsx("div",{className:"flex mt-5 justify-end",children:e.jsx("button",{className:"btn btn-outline btn-info w-full",onClick:()=>{l&&l(),a()},children:"确认"})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{})})]})}),document.body):null},h=({defaultValue:t,onChange:n})=>{const s=React.useRef(null),[a,l]=React.useState("auto"),o=React.useCallback((()=>{l("auto"),(null==s?void 0:s.current)&&s.current.scrollHeight&&l(s.current.scrollHeight)}),[s]);React.useEffect((()=>{o()}),[t,o,s]);return e.jsx(d,{children:e.jsx("textarea",{className:"textarea textarea-bordered w-full mt-4 h-fit",ref:s,placeholder:"Bio",defaultValue:t,onChange:e=>{o(),n&&n(e)},style:{height:a}})})},f=({text:t,duration:n=2e3,onClose:s})=>(React.useEffect((()=>{const e=setTimeout((()=>{s&&s()}),n);return()=>{clearTimeout(e)}}),[n,s]),ReactDOM.createPortal(e.jsx(d,{children:e.jsx("div",{className:"toast toast-top toast-center",children:e.jsx("div",{className:"alert alert-success flex",children:t})})}),document.body)),x=({value:t,onEdit:s})=>e.jsx(d,{children:e.jsx(n,{value:t,onEdit:e=>{s&&s()}})}),b=({tabs:t,initialActiveKey:n,onChange:s})=>{const[a,l]=React.useState(n||(t.length>0?t[0].key:""));return e.jsxs(d,{children:[e.jsx("div",{role:"tablist",className:"tabs tabs-boxed",children:t.map((t=>e.jsx("button",{role:"tab",className:"tab "+(a===t.key?"tab-active":""),onClick:()=>{return e=t.key,l(e),void(s&&s(e));var e},children:t.label},`tab-${t.key}`)))}),e.jsx("div",{className:"tabs-content mt-2",children:t.map((t=>e.jsx("div",{role:"tabpanel",className:"tab-panel "+(a===t.key?"active":""),style:{display:a===t.key?"block":"none",transition:"opacity 0.3s ease-in-out",opacity:a===t.key?1:0},children:t.content},`content-${t.key}`)))})]})},g=e=>localStorage.getItem(e),j=(e,t)=>localStorage.setItem(e,t),{getDayDetail:y}=l;dayjs.extend(s),dayjs.extend(a);const p=dayjs,k=()=>new Date,N=e=>`${Math.floor(e/3600)} 小时 ${Math.floor(e%3600/60)} 分 ${e%60} 秒`,R=()=>{const e=dayjs(),t=e.startOf("week"),n=e.endOf("week"),s=[];let a=t;for(;a.isSameOrBefore(n);)s.push(a.format("YYYY-MM-DD")),a=a.add(1,"day");return s},v=({addToast:t,openModal:n,setExportData:s})=>{const[a,l]=React.useState("morning"),[r,c]=React.useState(null),[i,u]=React.useState(null),[m,h]=React.useState([]),[f,x]=React.useState(null),[b,v]=React.useState(null),[S,M]=React.useState(null),C=React.useCallback((()=>{const e=g("weekData");try{if(e){const t=JSON.parse(e);return s&&s(t),t}}catch(t){return[]}return[]}),[s]),D=React.useCallback((e=>{const t=String(e),n=p(e).format("YYYY-MM-DD");h((e=>{const s=[...e],l=s.findIndex((e=>e.date===n));-1!==l?"morning"===a?s[l].morning=t:s[l].night=t:s.push({date:n,morning:"morning"===a?t:null,night:"night"===a?t:null});const o=JSON.stringify(s);return j("weekData",o),s}))}),[a]),w=React.useCallback((()=>{const e=k();j(`${a}`,String(e)),"morning"===a?(c(p(e).format("MM-DD HH-mm")),l("night")):u(p(e).format("MM-DD HH-mm")),D(e)}),[a,D]);React.useEffect((()=>{const e=g("morning"),t=g("night"),n=C();if(n.length>0&&h(n),e){const t=p(e);t.format("dd")===p().format("dd")&&l("night"),c(t.format("MM-DD HH-mm"))}t&&u(p(t).format("MM-DD HH-mm"))}),[C]),React.useEffect((()=>{let e=0;const t=p().week(),n=(e,t)=>t.diff(e,"second");for(let s=0;s<m.length;s++){const a=m[s],{date:l,morning:o,night:r}=a;if(!o||!r||p(l).week()!==t)continue;const c=n(p(o),p(r));c>0&&(e+=c)}e>0&&(v(N(e)),M(N((()=>{const e=R();let t=0;return e.forEach((e=>{y(e).work&&t++})),11.5*t*3600})()-e)))}),[m]),React.useEffect((()=>{let e;if(r&&i){const t=p(g("morning")),n=()=>{const e=k(),n=p(e).diff(t,"second"),s=Math.floor(n/3600),a=Math.floor((n-3600*s)/60);x(`${s} 小时 ${a} 分 ${n%60} 秒`),j("night",String(e)),D(e)};n(),e=setInterval(n,1e3)}return()=>{clearInterval(e)}}),[r,i,D]);const O=React.useCallback((()=>{const e=C();o(JSON.stringify(e)),t({text:"复制成功"})}),[C,t]),E=React.useCallback((()=>{const e=C();s(e),n()}),[C,n,s]);return e.jsxs(d,{children:[e.jsxs("div",{children:[e.jsx("button",{className:"morning"===a?"btn mr-6 btn-outline":"btn mr-6 btn-accent",onClick:w,children:e.jsx("h2",{className:"text-lg font-bold",children:"morning"===a?"早上打卡":"晚上打卡"})}),e.jsx("button",{className:"mr-6 btn btn-outline btn-info",onClick:O,children:e.jsx("h2",{className:"text-lg font-bold",children:"导出数据"})}),e.jsx("button",{className:"btn btn-outline btn-secondary",onClick:E,children:e.jsx("h2",{className:"text-lg font-bold",children:"导入数据"})})]}),e.jsx("div",{className:"card w-90 shadow-xl bg-teal-100 mt-6",children:e.jsxs("div",{className:"card-body p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["上次早上打卡时间: ",r]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["上次晚上打卡时间: ",i]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["今天已经工作时长: ",f]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["本周已经工作时长: ",b]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["本周剩余工作时长: ",S]})]})})]})};function S(){const[t,n]=React.useState(!0),{ToastContainer:s,addToast:a}=(()=>{const[t,n]=React.useState([]),s=React.useCallback((({text:e,duration:t=2e3})=>{const s=Date.now();n((n=>[...n,{id:s,text:e,duration:t}])),setTimeout((()=>{n((e=>e.filter((e=>e.id!==s))))}),t)}),[]),a=React.useCallback((e=>{n((t=>t.filter((t=>t.id!==e))))}),[]);return{toasts:t,addToast:s,removeToast:a,ToastContainer:()=>e.jsx(e.Fragment,{children:t.map((t=>e.jsx(f,{text:t.text,duration:t.duration,onClose:()=>a(t.id)},t.id)))})}})(),{isOpen:l,openModal:o,closeModal:r}=(()=>{const[e,t]=React.useState(!1);return{isOpen:e,openModal:()=>t(!0),closeModal:()=>t(!1)}})();React.useEffect((()=>{setTimeout((()=>{n(!1)}),1e3)}),[]);const[c,i]=React.useState({}),g=React.useCallback((()=>{j("weekData",JSON.stringify(c)),n(!0),setTimeout((()=>{n(!1),a({text:"导入成功"})}),1e3)}),[a,c]);return e.jsx(d,{children:e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[t?e.jsx(u,{}):e.jsx("div",{className:"flex flex-col items-center",children:e.jsx(v,{addToast:a,openModal:o,setExportData:i})}),e.jsx(s,{}),e.jsx(m,{isOpen:l,onClose:r,title:"导入数据",onOk:g,children:e.jsx(b,{tabs:[{key:"Textarea",label:"Textarea",content:e.jsx(h,{defaultValue:JSON.stringify(c),onChange:e=>{try{i(JSON.parse(e.target.value))}catch(t){}}})},{key:"JSON",label:"JsonEditor",content:e.jsx(x,{value:c})}]})})]})})}const M=r([{path:"/",element:e.jsx(S,{})},{path:"*",element:e.jsx(S,{})}]),C=document.getElementById("root");if(C){ReactDOM.createRoot(C).render(e.jsx(React.StrictMode,{children:e.jsx(c,{router:M})}))}
