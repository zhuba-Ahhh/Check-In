import{j as e,E as t,J as a,w as n,i as s,a as l,c as o,b as r,R as c}from"./.pnpm-BAJQPn5i.js";function i({error:t}){return e.jsxs("div",{role:"alert",children:[e.jsx("p",{children:"Something went wrong:"}),e.jsx("pre",{style:{color:"red"},children:t.message})]})}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const d=({children:a,fallback:n})=>e.jsx(t,{fallbackRender:n?()=>n:i,children:a}),u=()=>e.jsx(d,{children:e.jsx("div",{className:"flex justify-center content-center min-h-screen",style:{mask:"linear-gradient(black, transparent)"},children:e.jsx("span",{className:"loading loading-spinner loading-lg",style:{width:"3rem"}})})}),m=({title:t,children:a,isOpen:n,onClose:s,onOk:l})=>{const o=React.useRef(null);return React.useEffect((()=>{n&&(null==o?void 0:o.current)&&(null==o||o.current.showModal());const e=e=>"Escape"===e.key?s():null;return document.body.addEventListener("keydown",e),()=>{document.body.removeEventListener("keydown",e)}}),[s,n,o]),n?ReactDOM.createPortal(e.jsx(d,{children:e.jsxs("dialog",{id:"my_modal_2",className:"modal",ref:o,children:[e.jsxs("div",{className:"modal-box",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("h2",{children:t}),e.jsx("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-3 top-4",onClick:s,children:"✕"})]}),a,e.jsx("div",{className:"flex mt-5 justify-end",children:e.jsx("button",{className:"btn btn-outline btn-info w-full",onClick:()=>{l&&l(),s()},children:"确认"})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{})})]})}),document.body):null},h=({defaultValue:t,onChange:a})=>{const n=React.useRef(null),[s,l]=React.useState("auto"),o=React.useCallback((()=>{l("auto"),(null==n?void 0:n.current)&&n.current.scrollHeight&&l(n.current.scrollHeight)}),[n]);React.useEffect((()=>{o()}),[t,o,n]);return e.jsx(d,{children:e.jsx("textarea",{className:"textarea textarea-bordered w-full mt-4 h-fit",ref:n,placeholder:"Bio",defaultValue:t,onChange:e=>{o(),a&&a(e)},style:{height:s}})})},f=({text:t,duration:a=2e3,onClose:n})=>(React.useEffect((()=>{const e=setTimeout((()=>{n&&n()}),a);return()=>{clearTimeout(e)}}),[a,n]),ReactDOM.createPortal(e.jsx(d,{children:e.jsx("div",{className:"toast toast-top toast-center",children:e.jsx("div",{className:"alert alert-success flex",children:t})})}),document.body)),x=({value:t,onEdit:n})=>e.jsx(d,{children:e.jsx(a,{value:t,onEdit:e=>{n&&n()}})}),y=({tabs:t,initialActiveKey:a,onChange:n})=>{const[s,l]=React.useState(a||(t.length>0?t[0].key:""));return e.jsxs(d,{children:[e.jsx("div",{role:"tablist",className:"tabs tabs-boxed",children:t.map((t=>e.jsx("button",{role:"tab",className:"tab "+(s===t.key?"tab-active":""),onClick:()=>{return e=t.key,l(e),void(n&&n(e));var e},children:t.label},`tab-${t.key}`)))}),e.jsx("div",{className:"tabs-content mt-2",children:t.map((t=>e.jsx("div",{role:"tabpanel",className:"tab-panel "+(s===t.key?"active":""),style:{display:s===t.key?"block":"none",transition:"opacity 0.3s ease-in-out",opacity:s===t.key?1:0},children:t.content},`content-${t.key}`)))})]})},p=e=>localStorage.getItem(e),b=(e,t)=>localStorage.setItem(e,t),{getDayDetail:g}=l;dayjs.extend(n),dayjs.extend(s);const j=dayjs,k=()=>new Date,N=e=>`${Math.floor(e/3600)} 小时 ${Math.floor(e%3600/60)} 分 ${e%60} 秒`,E=()=>{const e=dayjs(),t=e.startOf("week"),a=e.endOf("week"),n=[];let s=t;for(;s.isSameOrBefore(a);)n.push(s.format("YYYY-MM-DD")),s=s.add(1,"day");return n},R="morning",T="night",D="weekData",S="MM-DD HH-mm",v={type:"morning",morning:null,night:null,weekData:[],duration:null},w=(e,t)=>{switch(t.type){case"SET_TYPE":return{...e,type:t.payload};case"SET_MORNING":return{...e,morning:t.payload};case"SET_NIGHT":return{...e,night:t.payload};case"SET_WEEK_DATA":return{...e,weekData:t.payload};case"SET_DURATION":return{...e,duration:t.payload};default:return e}},O=({addToast:t,openModal:a,setExportData:n})=>{const[s,l]=React.useReducer(w,v),{getWeekData:r}=(e=>({getWeekData:React.useCallback((()=>{const t=p(D);try{if(t){const a=JSON.parse(t);return null==e||e(a),a}}catch(a){}return[]}),[e])}))(n),c=React.useCallback((e=>{const t=String(e),a=j(e).format("YYYY-MM-DD");l({type:"SET_WEEK_DATA",payload:s.weekData.map((e=>e.date===a?{...e,[s.type]:t}:e))}),b(D,JSON.stringify(s.weekData))}),[s.type,s.weekData]),i=React.useCallback((()=>{const e=k();b(s.type,String(e)),"morning"===s.type?(l({type:"SET_MORNING",payload:j(e).format(S)}),l({type:"SET_TYPE",payload:"night"})):l({type:"SET_NIGHT",payload:j(e).format(S)}),c(e)}),[s.type,c]);React.useEffect((()=>{const e=p(R),t=p(T),a=r();if(a.length>0&&l({type:"SET_WEEK_DATA",payload:a}),e){const t=j(e);t.format("dd")===j().format("dd")&&l({type:"SET_TYPE",payload:"night"}),l({type:"SET_MORNING",payload:t.format(S)})}t&&l({type:"SET_NIGHT",payload:j(t).format(S)})}),[r]);const{weeklyDuration:u,residualDuration:m}=React.useMemo((()=>{let e=0;const t=j().week();if(s.weekData.forEach((a=>{const{date:n,morning:s,night:l}=a;if(s&&l&&j(n).week()===t){const t=j(l).diff(j(s),"second");t>0&&(e+=t)}})),e>0){const t=N(e),a=(()=>{const e=E();let t=0;return e.forEach((e=>{g(e).work&&t++})),11.5*t*3600})()-e;return{weeklyDuration:t,residualDuration:N(Math.max(a,0))}}return{weeklyDuration:null,residualDuration:null}}),[s.weekData]);React.useEffect((()=>{let e;if(s.morning&&s.night){const t=j(p(R)),a=()=>{const e=k(),a=j(e).diff(t,"second");l({type:"SET_DURATION",payload:N(a)}),b(T,String(e)),c(e)};a(),e=setInterval(a,1e3)}return()=>{clearInterval(e)}}),[s.morning,s.night,c]);const h=React.useCallback((()=>{const e=r();o(JSON.stringify(e)),t({text:"复制成功"})}),[r,t]),f=React.useCallback((()=>{const e=r();n(e),a()}),[r,a,n]);return e.jsxs(d,{children:[e.jsxs("div",{children:[e.jsx("button",{className:"morning"===s.type?"btn mr-6 btn-outline":"btn mr-6 btn-accent",onClick:i,children:e.jsx("h2",{className:"text-lg font-bold",children:"morning"===s.type?"早上打卡":"晚上打卡"})}),e.jsx("button",{className:"mr-6 btn btn-outline btn-info",onClick:h,children:e.jsx("h2",{className:"text-lg font-bold",children:"导出数据"})}),e.jsx("button",{className:"btn btn-outline btn-secondary",onClick:f,children:e.jsx("h2",{className:"text-lg font-bold",children:"导入数据"})})]}),e.jsx("div",{className:"card w-90 shadow-xl bg-teal-100 mt-6",children:e.jsxs("div",{className:"card-body p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["上次早上打卡时间: ",s.morning]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["上次晚上打卡时间: ",s.night]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["今天已经工作时长: ",s.duration]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["本周已经工作时长: ",u]}),e.jsxs("h2",{className:"text-lg font-semibold",children:["本周剩余工作时长: ",m]})]})})]})};function C(){const[t,a]=React.useState(!0),{ToastContainer:n,addToast:s}=(()=>{const[t,a]=React.useState([]),n=React.useCallback((({text:e,duration:t=2e3})=>{const n=Date.now();a((a=>[...a,{id:n,text:e,duration:t}])),setTimeout((()=>{a((e=>e.filter((e=>e.id!==n))))}),t)}),[]),s=React.useCallback((e=>{a((t=>t.filter((t=>t.id!==e))))}),[]);return{toasts:t,addToast:n,removeToast:s,ToastContainer:()=>e.jsx(e.Fragment,{children:t.map((t=>e.jsx(f,{text:t.text,duration:t.duration,onClose:()=>s(t.id)},t.id)))})}})(),{isOpen:l,openModal:o,closeModal:r}=(()=>{const[e,t]=React.useState(!1);return{isOpen:e,openModal:()=>t(!0),closeModal:()=>t(!1)}})();React.useEffect((()=>{setTimeout((()=>{a(!1)}),1e3)}),[]);const[c,i]=React.useState({}),p=React.useCallback((()=>{b("weekData",JSON.stringify(c)),a(!0),setTimeout((()=>{a(!1),s({text:"导入成功"})}),1e3)}),[s,c]);return e.jsx(d,{children:e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[t?e.jsx(u,{}):e.jsx("div",{className:"flex flex-col items-center",children:e.jsx(O,{addToast:s,openModal:o,setExportData:i})}),e.jsx(n,{}),e.jsx(m,{isOpen:l,onClose:r,title:"导入数据",onOk:p,children:e.jsx(y,{tabs:[{key:"Textarea",label:"Textarea",content:e.jsx(h,{defaultValue:JSON.stringify(c),onChange:e=>{try{i(JSON.parse(e.target.value))}catch(t){}}})},{key:"JSON",label:"JsonEditor",content:e.jsx(x,{value:c})}]})})]})})}const M=r([{path:"/",element:e.jsx(C,{})},{path:"*",element:e.jsx(C,{})}]),_=document.getElementById("root");if(_){ReactDOM.createRoot(_).render(e.jsx(React.StrictMode,{children:e.jsx(c,{router:M})}))}
